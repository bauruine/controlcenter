<%= render :partial => "header", :object => {
  "title" => "UPD89",
  "actions" =>[]
} %>

<div class="col_12">
  <p class="col_12">Hello, <%= link_to current_user.name, user_path(current_user.id) %>!</p>

  <div class="col_8 dashboard_box sysBG">
    <h4>Systems</h4>
    <div class="col_6">
      <div id="systemChart"
           data-total="<%= @systems.count %>"
           data-ok="<%= get_systems_without_updates_or_queued.count %>"
           data-progress="<%= get_systems_with_queued_updates.count %>"
           data-warning="<%= get_systems_with_available_updates_only.count %>"></div>
    </div>
    <div class="col_6">
      <ul>
        <li><%= @systems.count %> Systems present</li>
        <% if get_not_recently_seen_systems.count > 0 %>
        <li><%= get_not_recently_seen_systems.count %> Systems not seen in past <%= Settings.Systems.NotSeenWarningThresholdMinutes / 60 %> hours</li>
        <% end %>
        <% if get_systems_without_group.count > 0 %>
        <li><%= get_systems_without_group.count %> Systems not in a group</li>
        <% end %>
      </ul>

      <% if get_systems_without_group.count > 0 %>
        <%= link_to("Assign to a group", :assign_systems, class: "button") %>
      <% end %>
    </div>
    <div class="floatFix"></div>
  </div>

  <div class="col_4 dashboard_box pkgBG">
    <h4>Packages</h4>
    <ul>
      <li><%= @packages.count %> known Packages</li>
      <% if get_packages_without_group.count > 0 %>
      <li><%= get_packages_without_group.count %> Packages not in a group</li>
      <% end %>
    </ul>

    <% if get_packages_without_group.count > 0 %>
      <%= link_to("Assign to groups", :assign_packages, class: "button") %>
    <% end %>
    <div class="floatFix"></div>
  </div>

  <div class="floatFix"></div>

  <div class="col_6 dashboard_box">
    <h4>Tasks</h4>

    <ul class="noDots">
    <% if get_running_tasks.count > 0 %>
      <li><%= get_running_tasks.count %> pending Tasks</li>
    <% end %>
    <% if get_failed_tasks.count > 0 %>
      <li class="errorText"><i class="fa fa-exclamation-triangle"></i> <%= get_failed_tasks.count %> failed Tasks</li>
    <% end %>
    <% if get_overdue_tasks.count > 0 %>
      <li class="warnText"><i class="fa fa-clock-o"></i> <%= get_overdue_tasks.count %> Tasks overdue!
          <% get_overdue_tasks.take( Settings.Dashboard.NrOfOverdueTasksShown ).each do |task| %>
          <div><%= link_to(task.id, task) + ": " + task.decorated_created_at + ", " + task.task_state.name %></div>
          <% end %>
          <% if get_overdue_tasks.count > Settings.Dashboard.NrOfOverdueTasksShown %>...<% end %>
      </li>
    <% end %>
    </ul>

    <div class="floatFix"></div>
  </div>

  <div class="col_6 dashboard_box sysBG">
    <h4>Available Updates</h4>
    <div class="col_6">
      <h6>By System:</h6>
      <% @updatable_systems.take( Settings.Dashboard.NrOfEntitiesWithUpdatesShown ).each do |sys| %>
        <div><%= link_to(sys.name, sys) + ": " + sys.get_installable_CPVs.count.to_s %></div>
      <% end %>
      <% if @updatable_systems.count > Settings.Dashboard.NrOfEntitiesWithUpdatesShown %>...<% end %>
    </div>

    <div class="col_6">
      <h6>By Group:</h6>
      <% @updatable_system_groups.take( Settings.Dashboard.NrOfEntitiesWithUpdatesShown ).each do |sys_grp| %>
        <div><%= link_to(sys_grp.name, sys_grp) + ": " + sys_grp.get_nr_of_installable_CPVs.to_s %></div>
      <% end %>
      <% if @updatable_system_groups.count > Settings.Dashboard.NrOfEntitiesWithUpdatesShown %>...<% end %>
    </div>
    <div class="floatFix"></div>
  </div>

  <div class="col_12 dashboard_box">
    <h4>Recent Activity</h4>
    <% get_tasks_for_recent_activities.each do |t| %>
      <div><%= link_to( t.to_full_sentence + t.state_description, t) %></div>
    <% end %>
    <div class="floatFix"></div>
  </div>
</div>

<div class="floatFix"></div>
