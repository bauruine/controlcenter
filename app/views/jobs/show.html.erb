<%= render :partial => "header",
:object => {
  "title" => "Job " + params[:id],
  "entity" => @job,
  "actions" =>[{
    "icon" => "arrow-left",
    "text" => "",
    "path" => jobs_path
  }, {
    "icon" => "pencil",
    "text" => "",
    "path" => edit_job_path(@job),
    "ctrlAction" => :edit
  }, {
    "icon" => "remove",
    "text" => "",
    "path" => @job,
    "ctrlAction" => :destroy,
    "method" => :delete,
    "confirm" => "Are you sure you want to delete this job?"
  }]
} %>

<% if @job.is_in_preview %>
  <h5>Please review the job</h5>
<% end %>

<ul class="properties col_6">
  <li>
    <p>
      <span class="property">Started at</span>
      <span class="value"><%= @job.decorated_started_at %></span>
    </p>
  </li>
  <li>
    <p>
      <span class="property">User</span>
      <span class="value"><%= @job.user.name %></span>
    </p>
  </li>
</ul>

<% if @paginated_tasks.length %>
<table>
  <thead>
    <tr>
      <th>State</th>
      <th>Execution</th>
      <th>System</th>
      <th># of Updates</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @paginated_tasks.each do |task| %>
      <tr>
        <td><%= task.task_state.name if task.task_state %></td>
	      <td><%= link_to task.task_execution.log[0..26], task.task_execution if task.task_execution %></td>
        <td><%= task.concrete_package_versions.first.system.name if task.concrete_package_versions.length > 0 %></td>
        <td><%= task.concrete_package_versions.length %></td>
        <td><%= link_to task.id, task %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<% if @job.is_in_preview %>
  <div class="actions">
    <%= form_for @job, :url => { :action => "execute" }, :html => { :method => :put } do |f| %>
      <%= submit_tag "Execute Job", :name => 'execute', :id=>"executeJobBtn" %>
      <%= submit_tag "Cancel Job", :name => 'cancel', :id=>"cancelJobBtn" %>
    <% end %>
  </div>
<% end %>

<div class="digg_pagination">
  <div class="page_info">
    <%= page_entries_info @paginated_tasks %>
  </div>
  <%= will_paginate @paginated_tasks, :container => false %>
</div>
<% end %>

<div class="floatFix"></div>
